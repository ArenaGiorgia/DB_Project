# ==========================================
# TEST USER MANAGER (Microservizio 1)
# ==========================================

### 1. REGISTRAZIONE UTENTE (Primo Tentativo)
# Crea l'utente. Inseriamo un ID univoco "req-100".
# CI ASPETTIAMO: 201 Created - "Registrazione completata!"
POST http://localhost:5000/users
Content-Type: application/json
Request-ID: req-100

{
  "email": "student@unict.it",
  "password": "passwordEsame2025",
  "nome": "Mario",
  "cognome": "Rossi"
}

###

### 1.1 RETRY REGISTRAZIONE (Simulazione At-Most-Once)
# RI-Inviamo ESATTAMENTE lo stesso ID "req-100".
# Il server guarda la Cache, vede "req-100" e ci ridà la vecchia risposta positiva.
# CI ASPETTIAMO: 201 Created (dalla Cache) - NON "già registrato".
POST http://localhost:5000/users
Content-Type: application/json
Request-ID: req-100

{
  "email": "student@unict.it",
  "password": "passwordEsame2025",
  "nome": "Mario",
  "cognome": "Rossi"
}

###

### 1.2 REGISTRAZIONE DUPLICATA (Logica di Business)
# Inviamo un NUOVO ID "req-101", ma con la STESSA EMAIL.
# Qui la Cache non trova nulla (ID nuovo). Va al DB, trova la mail esistente.
# CI ASPETTIAMO: 200 OK - "Utente già registrato"
POST http://localhost:5000/users
Content-Type: application/json
Request-ID: req-101

{
  "email": "student@unict.it",
  "password": "passwordEsame2025",
  "nome": "Mario",
  "cognome": "Rossi"
}

###

### 2. CANCELLAZIONE UTENTE (Richiesta PDF)
# Testiamo se la cancellazione funziona (richiede password).
# NOTA: Se esegui questo ora, dopo dovrai registrare di nuovo l'utente (step 1) per continuare i test sotto!
DELETE http://localhost:5000/users
Content-Type: application/json

{
  "email": "student@unict.it",
  "password": "passwordEsame2025"
}

###


# ==========================================
# TEST DATA COLLECTOR (Microservizio 2)
# ==========================================

### 3. AGGIUNTA INTERESSE (Richiesta PDF) - LONDRA
# L'utente dice: "Voglio monitorare Heathrow (EGLL)".
# Il Data Collector chiama User Manager via gRPC per verificare l'identità.
# Se torna 200 OK, l'aeroporto viene aggiunto al monitoraggio ciclico.
POST http://localhost:5001/interests
Content-Type: application/json

{
  "email": "student@unict.it",
  "airport": "EGLL"
}

###

### 3.1 AGGIUNTA INTERESSE - ROMA
# Aggiungiamo anche Fiumicino (LIRF)
POST http://localhost:5001/interests
Content-Type: application/json

{
  "email": "student@unict.it",
  "airport": "LIRF"
}

###

### 4. AGGIUNTA INTERESSE - UTENTE NON REGISTRATO (Test Sicurezza)
# Proviamo con una mail falsa. Deve dare errore 403 (Forbidden) o 404.
# Questo dimostra che il canale gRPC funziona.
POST http://localhost:5001/interests
Content-Type: application/json

{
  "email": "hacker@fake.it",
  "airport": "EGLL"
}

###

### 5. STATISTICA: ULTIMO VOLO (Richiesta PDF)
# Recupera l'ultimo volo registrato nel database per LIRF o EGLL.
GET http://localhost:5001/flights/last?airport=EGLL
Accept: application/json

###

GET http://localhost:5001/flights/last?airport=LIRF
Accept: application/json

###

### 6. STATISTICA: MEDIA VOLI (Richiesta PDF)
# Calcola la media dei voli registrati negli ultimi X giorni (es. 7 giorni).
GET http://localhost:5001/flights/average?airport=EGLL&days=7
Accept: application/json